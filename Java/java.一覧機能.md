# 一覧表示機能を実装

Javaでデータベースを利用することは少し難しいため、以下の流れで実装を行なっていきます。


① データベースは使用せず、コントローラー内で作成したリストをビューで表示できるようにする


② データベースと連携し、テーブル内のデータをビューで一覧表示できるようにする


FirstAppでは、以下のようにidカラムとmemoカラムのみを扱うシンプルなテーブルを作成します。
>id: 投稿ごとにつけるid

>memo：	投稿されたテキスト


# 一覧表示機能の実装


### 一覧表示用のビューを作成する
##### ビューファイルの編集・作成
[![Image from Gyazo](https://i.gyazo.com/73e8ea956f1580c3f8a9725dedc31cec.png)](https://gyazo.com/73e8ea956f1580c3f8a9725dedc31cec)



##### コントローラーを編集から実装


##### コントローラから見てみましょう。
[![Image from Gyazo](https://i.gyazo.com/233f83721e30c5cba0eab2e24649fc6a.png)](https://gyazo.com/233f83721e30c5cba0eab2e24649fc6a)

一覧表示を行うためのメソッドを、「showList」という名称で追加しています。



また、@GetMappingとアノテーションの記述を行なっていますが、これは@GetMapping("/")と書くのと同じ意味です。

💡**ルートパス（/）を指定する場合の("/")は省略可能です。**

アプリを起動して、ルートパスにアクセスしましょう（localhost:8080）


##### 画像の右と同じ表示になれば成功です。

[![Image from Gyazo](https://i.gyazo.com/40fb9d6227b0032666d2c73ddec6be55.png)](https://gyazo.com/40fb9d6227b0032666d2c73ddec6be55)




### エンティティを作成する
エンティティは、データベースの世界でよく使われる言葉で、簡単に言うと「データの塊」を表すものです。
エンティティはテーブル全体、カラムはテーブルの列とイメージすると分かりやすいです。

>例えば、オンラインストアで管理する「商品」や「顧客」といった一つ一つのものがエンティティに当たります。

エンティティには、テーブルの各カラムに対応した変数を用意します。

今回作成するテーブルには、id、memoというカラムがあるため、エンティティの変数としてid、memoを作成することになります。

>railsには、自動的にエンティティの機能が作成されています。

### ファイルを作成→エンティティの設定までの流れ


①エンティティ用のクラスファイルを作成

作成場所：「firstapp」「src」「main」「java」「in.techcamp.firstapp」


種類：Javaクラス


名称：PostEntity


②作成したPostEntityに、以下の記述を行いましょう。


以下の記述によって、DBのテーブルに含まれる「id」と「memo」カラムに対応するようエンティティを作成しています。


[![Image from Gyazo](https://i.gyazo.com/a92a8ce68daad9fcd8d25080fb16155b.png)](https://gyazo.com/a92a8ce68daad9fcd8d25080fb16155b)


続いて、このクラスにコンストラクタとゲッター・セッターを追加します。

>コンストラクタは、オブジェクトを初期化・生成する役割
>オブジェクトのプロパティ（変数）の値を取得する役割
>セッターは変数に不正な値が代入されるのを防ぎ、変数の値を設定する役割


これらのコードは、IntelliJの機能によって簡単に作成することができます。


この機能を使用すると、現在のカーソル位置にコードが追加されます。

空行を追加して、以下のようにカーソルを移動しましょう。

[![Image from Gyazo](https://i.gyazo.com/01a01cb5e63f034aaf6de211789b8d30.png)](https://gyazo.com/01a01cb5e63f034aaf6de211789b8d30)


続いて「コマンドキー + n」を押しましょう。
自動生成したいコードの種類を選択するダイアログが開きます。


「コンストラクター」が選択されているのを確認して、エンターキーを押しましょう。

idとmemoの両方を選択するので、「シフトキー + 下矢印キー」を押しましょう。

選択できたら、「OK」をクリックします。

[![Image from Gyazo](https://i.gyazo.com/2b8cdbe69eb5186d3232aa3f4f4d194d.gif)](https://gyazo.com/2b8cdbe69eb5186d3232aa3f4f4d194d)


[![Image from Gyazo](https://i.gyazo.com/87392888701649cb27b9a021508a3174.png)](https://gyazo.com/87392888701649cb27b9a021508a3174)

上記のようなコードが自動で表示されます。

次にセッター・ゲッターも同じやり方で設定します。

[![Image from Gyazo](https://i.gyazo.com/fb7b1e68bbfebaef6b741f77223db236.png)](https://gyazo.com/fb7b1e68bbfebaef6b741f77223db236)

ここまでの作業によって、以下のクラスができました。
- 変数として、idおよびmemoを宣言している
- 全ての変数を初期化するコンストラクタがある
- 全ての変数のゲッター・セッターがある


  このクラスをエンティティ（データの単位）として利用します。

  
続いて、このエンティティを使ってデータを作成できるよう、コントローラーにコードを追加していきます。

### コントローラーの設定

コントローラーでデータを作成し、ビューに渡せるようにします。


[![Image from Gyazo](https://i.gyazo.com/b0ae24308dd5dc28ac22cd0a0f9d23b6.png)](https://gyazo.com/b0ae24308dd5dc28ac22cd0a0f9d23b6)
※7行目も追加で記述します

このコードによって、以下の３件のデータを作成しています。

| id  | memo |
| ------------- | ------------- |
| 1  | 投稿1 |
| 2  | 投稿2 |
| 3  | 投稿3 |

List.ofメソッドは、文字通りリストを作成するメソッドです。
PostEntityクラスのオブジェクトを３つ作成して、それらをList.ofメソッドによって１つのリストにまとめています。


そして、作成したpostListをmodelに追加することでビューで使用できるようにしました。


💡同じパッケージの中であれば、インポートせずにPostControllerを使うことができます

### ビューを編集しよう
2・9・10行目を以下のように編集しましょう！

[![Image from Gyazo](https://i.gyazo.com/b216a42624e8da04b817625ca05e82fc.png)](https://gyazo.com/b216a42624e8da04b817625ca05e82fc)

9行目の`<ul th:each="post:${postList}">`の`th:each`は繰り返し処理の機能です。

`${postList}`の中には、コントローラーから渡されたリストの３件分の投稿データが含まれています。

th:eachを使うことで、まずpostListの１件目のデータが変数「post」に格納されます。



その状態で`<li th:text="${post.getMemo()}">`が実行されると実行結果が『投稿1』と表示されて繰り返される状態になります。

ブラウザで確認すると以下の通りです。



[![Image from Gyazo](https://i.gyazo.com/15345f17017fe584954acb750d097947.png)](https://gyazo.com/15345f17017fe584954acb750d097947)

以上が、コントローラから作成したリストをビューで表示することでした！


## データベース（MYSQL）から取得できるようにしよう！

データベースからデータを取得できるよう機能を追加していきます。

### ライブラリを導入しよう


MySQLを扱うため、以下３つのライブラリを使用します。


| ライブラリ名  | 機能 |
| ------------- | ------------- |
| MySQL Driver | JavaからMySQLを操作するためのライブラリ |
| MyBatis  | SQL文の発行を、Javaメソッドとして定義できるようにするライブラリ |
| Lombok  | コードの記述を簡略化するためのライブラリ |

これらを導入するため、設定ファイルを編集しましょう。

[![Image from Gyazo](https://i.gyazo.com/02cae3789b2638ed8c9171b9b72edbdc.gif)](https://gyazo.com/02cae3789b2638ed8c9171b9b72edbdc)


### lombokプラグインをインストールしよう

IntelliJでlombokを使用する場合、Lombokのアノテーションはデフォルトの状態だとIntelliJ IDEAによって認識されず、コードとして認識されない場合があります。（IDEは、プログラマーがコードを入力するたびに、リアルタイムでコードを解析し、その場で補完やリファクタリングの候補を提示します。しかし、Lombokのアノテーションによって生成されるコードは、コンパイル時に初めて生成されるため、IDEが解析する時点ではまだ存在しないことがある）
それを防ぐために、lombokプラグインをインストールしましょう。

設定▶︎「プラグイン▶︎ lombok▶︎ インストール▶︎  適用
[![Image from Gyazo](https://i.gyazo.com/73de8d5d1b59a4bec05166975576f3b9.gif)](https://gyazo.com/73de8d5d1b59a4bec05166975576f3b9)


### データベースを作成しよう

続いて、このアプリで使用するデータベースを作成します。


この操作は**ターミナル**で行いますので、まずターミナルを起動しましょう。


起動したら、以下のコマンドを実行します。


`mysql -u root`

MySQLが起動するので、以下のコマンドを実行しましょう。


`mysql> create database first_app_java;`

これで、「first_app_java」という名称のデータベースが作成されました。

以下のコマンドで、MySQLを終了します

`mysql>exit;`


### javaアプリからMySQLを使うための設定

「firstapp」「src」「main」「resources」フォルダにある「application.properties」ファイルで行います。

2行目からのコードを記述しましょう
[![Image from Gyazo](https://i.gyazo.com/efbc459ddadf1eb1ccfdd0c42a4848ff.png)](https://gyazo.com/efbc459ddadf1eb1ccfdd0c42a4848ff)


ここまでで操作でデータベースは作成しました

### テーブル作成


続いて、データベース内のテーブルを作成していきます

「schema.sql」ファイルを作成することで、アプリの起動時にSQLが発行され、テーブルを作成することができます。

以下の内容のファイルを作成してコードを書きましょう

>作成場所：src/main/resources
>
>種類：ファイル
>
>名前：schema.sql

[![Image from Gyazo](https://i.gyazo.com/fa6973ae443aa080cf8aa7a121abb586.png)](https://gyazo.com/fa6973ae443aa080cf8aa7a121abb586)


### アプリを実行してみよう！

アプリを実行することによってschema.sqlが実行され、postsテーブルが作成されます。


### テーブルにデータ追加しよう

Sequel Proを使用して、テーブルにデータを追加します。

まずはSequel Proを起動して、「first_app_java」のデータベースを開きましょう。

postsテーブルが作成されているので、クリックして選択します。

以下のデータをDBに記述していきます。


>id:1	  memo:初めての投稿
>
>id:2   memo:2回目の投稿
>
>id:3	  memo:3回目の投稿

[![Image from Gyazo](https://i.gyazo.com/5f5ddbd76a6bbcd11625f92833736f33.png)](https://gyazo.com/5f5ddbd76a6bbcd11625f92833736f33)


続いて、Javaアプリからこのデータベースにアクセスし、データを取得できるようにしていきましょう。
### データベースからデータを取得しよう
Javaアプリでデータベースを利用する際は、「リポジトリ」を作成します。

リポジトリとは、SQLの操作をJavaのメソッドとして定義するためのものです。
（Gitで使用するリポジトリとは別のものです）


「リポジトリ」は、データベースとのやり取りをJavaのコードで表現するための層です。

このリポジトリを作成していきましょう。

### ファイルを作成しよう


リポジトリ用のファイルを新規作成しましょう。
作成場所：src/main/java/in.techcamp.firstapp

種類：Javaクラス

名前：PostRepository・インターフェース

リポジトリの作成では、名前を入力する際に「インターフェース」を選択します

[![Image from Gyazo](https://i.gyazo.com/11c5ec635c540c9998182d88c09a6d96.png)](https://gyazo.com/11c5ec635c540c9998182d88c09a6d96)

インターフェースとは、クラスにどんな機能があるかを定めるもので、具体的にどう動くかは書かないというものです。
インターフェースは、それ自身を継承しクラスを作る、つまりクラスの元になるものです。

### リポジトリにコードを記述しよう

[![Image from Gyazo](https://i.gyazo.com/9cc02769b37b577355d206f50eff1b35.png)](https://gyazo.com/9cc02769b37b577355d206f50eff1b35)

このリポジトリで行いたいことは、postsテーブルから全件データを取得するための「findAll」というメソッドを定義することです。

### MyBatis
MyBatisとは、Javaで使われるデータベースへのアクセスを容易にするためのライブラリです。SQL文をそのまま利用することができるため、SQLが得意な方や複雑なクエリを使いたい場合に適しています。

早速、コードに何が書いてあるか見てみましょう！

[![Image from Gyazo](https://i.gyazo.com/2e38666d629cbf3d1424ef4e63ac63be.png)](https://gyazo.com/2e38666d629cbf3d1424ef4e63ac63be)

まず、インターフェイス名の上に **@Mapper**アノテーションをつけることで、MyBatisとSpring Bootがそのインターフェースを見ると「ここに定義されているメソッドの実装はSQLである と理解します。

**@Select("select * from posts")**

- @Select:このメソッドが実行されると、括弧内のSQL文がデータベースに送られます。
- "select * from posts": これは標準的なSQL文です。
- select: データベースからデータを取り出すための命令です。
- *: postsテーブルの全てのカラムを指定しています。
- from posts: データを取り出す対象のテーブルを指定しています。

  **List<PostEntity>**

- List: Javaのコレクションフレームワークの一つで、複数の要素を順序を保って格納できるインターフェースです。
- PostEntity: このコードでは、データベースから取得したデータを格納するためのクラスであると想定されます。このクラスは、postsテーブルの各カラムに対応するフィールドを持っているはずです。

  **findAll()**
  - findAll: このメソッドの名前は、postsテーブルの全てのレコード（行）を取得することを意味しています
 
  **コントローラーを編集しよう**
  コントローラーを編集して、データベースからデータを読み込めるようにしましょう。

以下のように変更しましょう。
